{"version":3,"file":"filterRowsUtils.js","sources":["../../../src/utils/filterRowsUtils.ts"],"sourcesContent":["import { createRow } from '../core/row'\nimport { Row, RowModel, Table, RowData } from '../types'\n\nexport function filterRows<TData extends RowData>(\n  rows: Row<TData>[],\n  filterRowImpl: (row: Row<TData>) => any,\n  table: Table<TData>\n) {\n  if (table.options.filterFromLeafRows) {\n    return filterRowModelFromLeafs(rows, filterRowImpl, table)\n  }\n\n  return filterRowModelFromRoot(rows, filterRowImpl, table)\n}\n\nexport function filterRowModelFromLeafs<TData extends RowData>(\n  rowsToFilter: Row<TData>[],\n  filterRow: (row: Row<TData>) => Row<TData>[],\n  table: Table<TData>\n): RowModel<TData> {\n  const newFilteredFlatRows: Row<TData>[] = []\n  const newFilteredRowsById: Record<string, Row<TData>> = {}\n\n  const recurseFilterRows = (rowsToFilter: Row<TData>[], depth = 0) => {\n    const rows: Row<TData>[] = []\n\n    // Filter from children up first\n    for (let i = 0; i < rowsToFilter.length; i++) {\n      let row = rowsToFilter[i]!\n\n      const newRow = createRow(\n        table,\n        row.id,\n        row.original,\n        row.index,\n        row.depth\n      )\n      newRow.columnFilters = row.columnFilters\n\n      if (row.subRows?.length) {\n        newRow.subRows = recurseFilterRows(row.subRows, depth + 1)\n        row = newRow\n\n        if (filterRow(row) && !newRow.subRows.length) {\n          rows.push(row)\n          newFilteredRowsById[row.id] = row\n          newFilteredRowsById[i] = row\n          continue\n        }\n\n        if (filterRow(row) || newRow.subRows.length) {\n          rows.push(row)\n          newFilteredRowsById[row.id] = row\n          newFilteredRowsById[i] = row\n          continue\n        }\n      } else {\n        row = newRow\n        if (filterRow(row)) {\n          rows.push(row)\n          newFilteredRowsById[row.id] = row\n          newFilteredRowsById[i] = row\n        }\n      }\n    }\n\n    return rows\n  }\n\n  return {\n    rows: recurseFilterRows(rowsToFilter),\n    flatRows: newFilteredFlatRows,\n    rowsById: newFilteredRowsById,\n  }\n}\n\nexport function filterRowModelFromRoot<TData extends RowData>(\n  rowsToFilter: Row<TData>[],\n  filterRow: (row: Row<TData>) => any,\n  table: Table<TData>\n): RowModel<TData> {\n  const newFilteredFlatRows: Row<TData>[] = []\n  const newFilteredRowsById: Record<string, Row<TData>> = {}\n\n  // Filters top level and nested rows\n  const recurseFilterRows = (rowsToFilter: Row<TData>[], depth = 0) => {\n    // Filter from parents downward first\n\n    const rows = []\n\n    // Apply the filter to any subRows\n    for (let i = 0; i < rowsToFilter.length; i++) {\n      let row = rowsToFilter[i]!\n\n      const pass = filterRow(row)\n\n      if (pass) {\n        if (row.subRows?.length) {\n          const newRow = createRow(\n            table,\n            row.id,\n            row.original,\n            row.index,\n            row.depth\n          )\n          newRow.subRows = recurseFilterRows(row.subRows, depth + 1)\n          row = newRow\n        }\n\n        rows.push(row)\n        newFilteredFlatRows.push(row)\n        newFilteredRowsById[row.id] = row\n      }\n    }\n\n    return rows\n  }\n\n  return {\n    rows: recurseFilterRows(rowsToFilter),\n    flatRows: newFilteredFlatRows,\n    rowsById: newFilteredRowsById,\n  }\n}\n"],"names":["filterRows","rows","filterRowImpl","table","options","filterFromLeafRows","filterRowModelFromLeafs","filterRowModelFromRoot","rowsToFilter","filterRow","newFilteredFlatRows","newFilteredRowsById","recurseFilterRows","depth","i","length","row","newRow","createRow","id","original","index","columnFilters","subRows","push","flatRows","rowsById","pass"],"mappings":"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"}